P8105 HW2 - swr2118
================

# Problem 1

``` r
library(tidyverse)

# Read data files
pols_month <- read_csv("pols-month.csv")
unemployment <- read_csv("unemployment.csv")
snp <- read_csv("snp.csv")

# Clean pols_month
pols_month_clean <- pols_month %>%
  separate(mon, into = c("year", "month", "day"), sep = "-") %>%
  mutate(
    year = as.integer(.data$year),
    month = as.integer(.data$month),
    president = if_else(prez_gop == 1, "gop", "dem")
  ) %>%
  select(-prez_dem, -prez_gop, -day)

# Clean snp
snp_clean <- snp %>%
  separate(date, into = c("year", "month", "day"), sep = "-") %>%
  mutate(
    year = as.integer(.data$year),
    month = as.integer(.data$month)
  ) %>%
  arrange(year, month) %>%
  select(year, month, close, everything(), -day)

# Clean unemployment
unemployment_tidy <- unemployment %>%
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment"
  ) %>%
  mutate(
    month = match(month, month.abb),
    year = as.integer(.data$Year)
  )

# Join datasets
combined <- pols_month_clean %>%
  left_join(snp_clean, by = c("year", "month")) %>%
  left_join(unemployment_tidy, by = c("year", "month"))

# Optionally add a character month name for display
combined <- combined %>%
  mutate(month_name = month.name[month])

glimpse(combined)
```

    ## Rows: 822
    ## Columns: 13
    ## $ year         <int> 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 194…
    ## $ month        <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, …
    ## $ gov_gop      <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 22, 22, 2…
    ## $ sen_gop      <dbl> 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 53, 53, 5…
    ## $ rep_gop      <dbl> 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, 25…
    ## $ gov_dem      <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 2…
    ## $ sen_dem      <dbl> 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 48, 48, 4…
    ## $ rep_dem      <dbl> 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 19…
    ## $ president    <chr> "dem", "dem", "dem", "dem", "dem", "dem", "dem", "dem", "…
    ## $ close        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
    ## $ Year         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 1948, 194…
    ## $ unemployment <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 3.4, 3.8,…
    ## $ month_name   <chr> "January", "February", "March", "April", "May", "June", "…

**Summary:**  
The pols-month file contains monthly political data on the presidency.
The snp file contains S&P index monthly closing data. The unemployment
file contains annual unemployment rates in wide format. After cleaning
and merging, the combined dataset has 822 rows and 13 columns, spanning
years 1947 to 2015. Key variables include year, month, president, S&P
closing value, and unemployment rate.

# Problem 2

``` r
# Read in all Trash Wheel sheets
mr_trash <- read_excel("202409 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", skip = 1)
prof_trash <- read_excel("202409 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", skip = 1)
gwynnda_trash <- read_excel("202409 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", skip = 1)

# Clean and add wheel name
clean_trash <- function(df, wheel_name, has_sports = FALSE) {
  df <- janitor::clean_names(df) %>% 
    filter(!is.na(dumpster))
  print(colnames(df)) # DEBUG: check column names
  if ("year" %in% names(df)) {
    df <- df %>% mutate(year = as.integer(year))
  }
  if (has_sports && "sports" %in% names(df)) {
    df <- df %>% mutate(sports = as.integer(round(sports)))
  }
  df %>%
    mutate(wheel = wheel_name)
}

mr_clean <- clean_trash(mr_trash, "Mr. Trash Wheel", has_sports = TRUE)
```

    ##  [1] "dumpster"           "month"              "year"              
    ##  [4] "date"               "weight_tons"        "volume_cubic_yards"
    ##  [7] "plastic_bottles"    "polystyrene"        "cigarette_butts"   
    ## [10] "glass_bottles"      "plastic_bags"       "wrappers"          
    ## [13] "sports_balls"       "homes_powered"      "x15"               
    ## [16] "x16"

``` r
prof_clean <- clean_trash(prof_trash, "Professor Trash Wheel")
```

    ##  [1] "dumpster"           "month"              "year"              
    ##  [4] "date"               "weight_tons"        "volume_cubic_yards"
    ##  [7] "plastic_bottles"    "polystyrene"        "cigarette_butts"   
    ## [10] "glass_bottles"      "plastic_bags"       "wrappers"          
    ## [13] "homes_powered"

``` r
gwynnda_clean <- clean_trash(gwynnda_trash, "Gwynnda Trash Wheel")
```

    ##  [1] "dumpster"           "month"              "year"              
    ##  [4] "date"               "weight_tons"        "volume_cubic_yards"
    ##  [7] "plastic_bottles"    "polystyrene"        "cigarette_butts"   
    ## [10] "plastic_bags"       "wrappers"           "homes_powered"

``` r
# Combine all
trash_all <- bind_rows(mr_clean, prof_clean, gwynnda_clean)

# Inline results
num_obs <- nrow(trash_all)
prof_total_weight <- sum(prof_clean$weight_tons, na.rm = TRUE)
gwynnda_june2022_cigs <- gwynnda_clean %>%
  filter(year == 2022, month == "June") %>%
  pull(cigarette_butts) %>% sum(na.rm = TRUE)
```

The combined trash wheel dataset has 1033 observations. Example
variables include `dumpster`, `month`, `year`, `weight_tons`,
`sports_balls`, and `cigarette_butts`.  
The total weight of trash collected by Professor Trash Wheel is 246.74
tons. Gwynnda collected 1.812^{4} cigarette butts in June 2022.

# Problem 3

``` r
# Load Zillow and ZIP code data
zillow <- read_csv("Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv")
zipcodes <- read_csv("Zip Codes.csv")

# Rename RegionName to ZipCode in zillow for joining
zillow <- zillow %>% rename(ZipCode = RegionName)

# Tidy zillow data
zillow_long <- zillow %>%
  pivot_longer(
    cols = matches("^\\d{4}-\\d{2}-\\d{2}$"),
    names_to = "date",
    values_to = "rent"
  ) %>%
  mutate(date = as.Date(date)) %>%
  left_join(zipcodes, by = "ZipCode") %>%
  mutate(borough = County)

# Summary stats
total_obs <- nrow(zillow_long)
unique_zips <- length(unique(zillow_long$ZipCode))
unique_neigh <- length(unique(zillow_long$Neighborhood))

# ZIPs in zipcodes not in zillow
missing_zips <- setdiff(zipcodes$ZipCode, zillow$ZipCode)

# Table: 10 ZIPs with largest rent drop Jan 2020 → Jan 2021
rent_2020_2021 <- zillow_long %>%
  filter(month(date) == 1, year(date) %in% c(2020, 2021)) %>%
  select(ZipCode, borough, Neighborhood, date, rent) %>%
  pivot_wider(names_from = date, values_from = rent, names_prefix = "rent_") %>%
  mutate(
    drop = .data[[paste0("rent_", as.Date("2021-01-31"))]] - .data[[paste0("rent_", as.Date("2020-01-31"))]]
  ) %>%
  arrange(drop) %>%
  slice(1:10)

rent_2020_2021 %>%
  select(ZipCode, borough, Neighborhood, drop)
```

    ## # A tibble: 10 × 4
    ##    ZipCode borough  Neighborhood                   drop
    ##      <dbl> <chr>    <chr>                         <dbl>
    ##  1   10007 New York Lower Manhattan               -913.
    ##  2   10069 New York <NA>                          -748.
    ##  3   10009 New York Lower East Side               -714.
    ##  4   10016 New York Gramercy Park and Murray Hill -712.
    ##  5   10001 New York Chelsea and Clinton           -710.
    ##  6   10002 New York Lower East Side               -710.
    ##  7   10004 New York Lower Manhattan               -706.
    ##  8   10038 New York Lower Manhattan               -698.
    ##  9   10012 New York Greenwich Village and Soho    -686.
    ## 10   10010 New York Gramercy Park and Murray Hill -685.

The tidy Zillow dataset contains 17516 observations, with 149 unique ZIP
codes and 43 unique neighborhoods.  
ZIP codes present in the ZIP code dataset but not in the Zillow rental
dataset include: 10464, 10474, 10475, 10499, 10550 (first 5 shown).
These ZIPs may be missing from Zillow if they are commercial,
uninhabited, or otherwise have no rental listings.  
The table above shows the 10 ZIP codes with the largest decrease in rent
from January 2020 to January 2021, likely reflecting COVID-19 market
effects.
